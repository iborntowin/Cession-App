import{g as Ps,f as xs}from"../chunks/api.b4688d57.js";import{r as Vs}from"../chunks/index.c6708bed.js";import{s as Ss,a as E,f as d,c as I,g as f,h as m,d as r,j as o,i as U,u as Ds,A as Je,l as w,F as lt,e as ks,m as D,G as nt,k as Ke,w as t,z as Ct,n as S,H as Ts,I as Q,y as me}from"../chunks/scheduler.fb6ad399.js";import{S as Bs,i as Ms,t as je,c as ss,a as He,g as ls,b as Fs,d as Ls,m as js,e as Hs}from"../chunks/index.19f0e15d.js";import"../chunks/paths.7a59b8f6.js";import{s as L,g as es,l as Le}from"../chunks/navigation.68a3d764.js";import{a as Es,o as Os,d as Us}from"../chunks/pdfGenerator.aa2f9fb1.js";import{P as zs}from"../chunks/PaymentSection.cedf78e6.js";import{t as Ws}from"../chunks/index.92f608cc.js";import{f as ts}from"../chunks/index.7c030542.js";async function Rs({params:a}){if(!a.id||a.id==="undefined"||!a.cessionId||a.cessionId==="undefined")throw Vs(303,"/clients");try{const e=Ps(),n=xs(),s=await fetch(`${e}/api/v1/clients/${a.id}`,{headers:n});if(!s.ok)throw new Error("Failed to fetch client");const i=await s.json(),c=await fetch(`${e}/api/v1/cessions/${a.cessionId}`,{headers:n});if(!c.ok)throw new Error("Failed to fetch cession");const l=await c.json();return{client:i,cession:l,clientId:a.id,cessionId:a.cessionId}}catch(e){throw e}}const _l=Object.freeze(Object.defineProperty({__proto__:null,load:Rs},Symbol.toStringTag,{value:"Module"}));function Gs(a){const e=a.slice(),n=100-e[1].remainingBalance/e[1].totalLoanAmount*100;return e[17]=n,e}function qs(a){let e,n,s,i,c=a[6]("navigation.back_to_cessions")+"",l,h,p,u,g=a[6]("cession.details")+"",y,T,P,x,C,V,j,W,M=a[6]("actions.preview_document")+"",v,b,A,H,R,ge,pe=a[6]("actions.download_document")+"",X,se,re,z,G,ie,q,_e,Ie,O=a[1]&&Is(a);const ce=[Xs,Qs,Ks],J=[];function be(k,B){return k[5]&&!k[1]?0:k[1]?1:2}return z=be(a),G=J[z]=ce[z](a),{c(){e=d("div"),n=d("div"),s=d("a"),i=w("← "),l=w(c),p=E(),u=d("h1"),y=w(g),T=E(),P=d("div"),x=d("button"),C=lt("svg"),V=lt("path"),j=lt("path"),W=E(),v=w(M),b=E(),A=d("button"),H=lt("svg"),R=lt("path"),ge=E(),X=w(pe),se=E(),O&&O.c(),re=E(),G.c(),ie=ks(),this.h()},l(k){e=f(k,"DIV",{class:!0});var B=m(e);n=f(B,"DIV",{});var Y=m(n);s=f(Y,"A",{href:!0,class:!0});var ue=m(s);i=D(ue,"← "),l=D(ue,c),ue.forEach(r),p=I(Y),u=f(Y,"H1",{class:!0});var ye=m(u);y=D(ye,g),ye.forEach(r),Y.forEach(r),T=I(B),P=f(B,"DIV",{class:!0});var le=m(P);x=f(le,"BUTTON",{class:!0,style:!0});var we=m(x);C=nt(we,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var ne=m(C);V=nt(ne,"path",{d:!0}),m(V).forEach(r),j=nt(ne,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),m(j).forEach(r),ne.forEach(r),W=I(we),v=D(we,M),we.forEach(r),b=I(le),A=f(le,"BUTTON",{class:!0,style:!0});var Z=m(A);H=nt(Z,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var De=m(H);R=nt(De,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),m(R).forEach(r),De.forEach(r),ge=I(Z),X=D(Z,pe),Z.forEach(r),se=I(le),O&&O.l(le),le.forEach(r),B.forEach(r),re=I(k),G.l(k),ie=ks(),this.h()},h(){o(s,"href",h=`/clients/${a[1]?.client?.id||a[0].clientId}/cessions`),o(s,"class","text-primary-600 hover:text-primary-800 mb-2 inline-block font-medium transition-colors"),o(u,"class","text-3xl font-bold text-gray-900 mt-2"),o(V,"d","M10 12a2 2 0 100-4 2 2 0 000 4z"),o(j,"fill-rule","evenodd"),o(j,"d","M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"),o(j,"clip-rule","evenodd"),o(C,"xmlns","http://www.w3.org/2000/svg"),o(C,"viewBox","0 0 20 20"),o(C,"fill","currentColor"),o(C,"class","h-5 w-5 mr-2 text-gray-500"),o(x,"class","inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"),Ke(x,"cursor","pointer"),Ke(x,"user-select","none"),Ke(x,"pointer-events","auto"),o(R,"fill-rule","evenodd"),o(R,"d","M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"),o(R,"clip-rule","evenodd"),o(H,"xmlns","http://www.w3.org/2000/svg"),o(H,"viewBox","0 0 20 20"),o(H,"fill","currentColor"),o(H,"class","h-5 w-5 mr-2 text-gray-500"),o(A,"class","inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"),Ke(A,"cursor","pointer"),Ke(A,"user-select","none"),Ke(A,"pointer-events","auto"),o(P,"class","flex gap-4"),o(e,"class","flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4")},m(k,B){U(k,e,B),t(e,n),t(n,s),t(s,i),t(s,l),t(n,p),t(n,u),t(u,y),t(e,T),t(e,P),t(P,x),t(x,C),t(C,V),t(C,j),t(x,W),t(x,v),t(P,b),t(P,A),t(A,H),t(H,R),t(A,ge),t(A,X),t(P,se),O&&O.m(P,null),U(k,re,B),J[z].m(k,B),U(k,ie,B),q=!0,_e||(Ie=[Ct(x,"click",a[10]),Ct(A,"click",a[11])],_e=!0)},p(k,B){(!q||B&64)&&c!==(c=k[6]("navigation.back_to_cessions")+"")&&S(l,c),(!q||B&3&&h!==(h=`/clients/${k[1]?.client?.id||k[0].clientId}/cessions`))&&o(s,"href",h),(!q||B&64)&&g!==(g=k[6]("cession.details")+"")&&S(y,g),(!q||B&64)&&M!==(M=k[6]("actions.preview_document")+"")&&S(v,M),(!q||B&64)&&pe!==(pe=k[6]("actions.download_document")+"")&&S(X,pe),k[1]?O?O.p(k,B):(O=Is(k),O.c(),O.m(P,null)):O&&(O.d(1),O=null);let Y=z;z=be(k),z===Y?J[z].p(k,B):(ls(),je(J[Y],1,1,()=>{J[Y]=null}),ss(),G=J[z],G?G.p(k,B):(G=J[z]=ce[z](k),G.c()),He(G,1),G.m(ie.parentNode,ie))},i(k){q||(He(G),q=!0)},o(k){je(G),q=!1},d(k){k&&(r(e),r(re),r(ie)),O&&O.d(),J[z].d(k),_e=!1,Ts(Ie)}}}function Js(a){let e,n=a[6]("cession.errors.invalid_id")+"",s;return{c(){e=d("div"),s=w(n),this.h()},l(i){e=f(i,"DIV",{class:!0});var c=m(e);s=D(c,n),c.forEach(r),this.h()},h(){o(e,"class","bg-red-50 text-red-700 p-4 rounded-md")},m(i,c){U(i,e,c),t(e,s)},p(i,c){c&64&&n!==(n=i[6]("cession.errors.invalid_id")+"")&&S(s,n)},i:Q,o:Q,d(i){i&&r(e)}}}function Is(a){let e,n=a[6]("actions.edit_cession")+"",s,i;return{c(){e=d("a"),s=w(n),this.h()},l(c){e=f(c,"A",{href:!0,class:!0});var l=m(e);s=D(l,n),l.forEach(r),this.h()},h(){o(e,"href",i=`/clients/${a[0].clientId}/cessions/${a[1].id}/edit`),o(e,"class","btn btn-secondary")},m(c,l){U(c,e,l),t(e,s)},p(c,l){l&64&&n!==(n=c[6]("actions.edit_cession")+"")&&S(s,n),l&3&&i!==(i=`/clients/${c[0].clientId}/cessions/${c[1].id}/edit`)&&o(e,"href",i)},d(c){c&&r(e)}}}function Ks(a){let e,n="Cession not found or you don't have permission to view this cession.";return{c(){e=d("div"),e.textContent=n,this.h()},l(s){e=f(s,"DIV",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-qodhdr"&&(e.textContent=n),this.h()},h(){o(e,"class","bg-red-50 text-red-700 p-4 rounded-md")},m(s,i){U(s,e,i)},p:Q,i:Q,o:Q,d(s){s&&r(e)}}}function Qs(a){let e,n,s,i,c,l=a[1].status+"",h,p,u,g,y,T,P=a[6]("cession.loan_details")+"",x,C,V,j,W,M=a[6]("cession.total_amount")+"",v,b,A,H,R=fe(a[1].totalLoanAmount)+"",ge,pe,X,se,re=a[6]("cession.monthly_payment")+"",z,G,ie,q,_e=fe(a[1].monthlyDeduction)+"",Ie,O,ce,J,be=a[6]("cession.remaining_balance")+"",k,B,Y,ue,ye=fe(a[1].remainingBalance)+"",le,we,ne,Z,De=a[6]("cession.bank_agency")+"",at,Pt,xt,Oe,Qe=a[1].bankOrAgency+"",ot,Vt,Ne,Ue,Xe=a[6]("cession.payment_schedule")+"",rt,St,de,Ae,Ce,Ye=a[6]("cession.start_date")+"",it,Tt,Bt,ze,Ze=a[9](a[1].startDate)+"",ct,Mt,Pe,xe,$e=a[6]("cession.end_date")+"",ut,Ft,Lt,We,et=a[9](a[1].endDate)+"",dt,jt,Ve,Se,tt=a[6]("cession.expected_payoff")+"",ft,Ht,Ot,Re,st=a[9](a[1].expectedPayoffDate)+"",mt,Ut,Ge,Te,zt,he,Be,ns="Cession Contract",Wt,Rt,ve,Me,as="Payments",Gt,$,ee,F,K=a[2]&&Ns(a);function os(_,N){return _[1].totalLoanAmount&&_[1].remainingBalance!==null?As:Ys}function qt(_,N){return N===As?Gs(_):_}let Fe=os(a),ae=Fe(qt(a,Fe));function rs(_,N){return _[4]?$s:Zs}let pt=rs(a),oe=pt(a);const is=[sl,tl,el],ke=[];function cs(_,N){return _[1]&&_[1].id&&!_[3]?0:_[3]?1:2}return $=cs(a),ee=ke[$]=is[$](a),{c(){e=d("div"),n=d("div"),s=d("div"),K&&K.c(),i=E(),c=d("span"),h=w(l),u=E(),g=d("div"),y=d("div"),T=d("h3"),x=w(P),C=E(),V=d("div"),j=d("p"),W=d("span"),v=w(M),b=w(":"),A=E(),H=d("span"),ge=w(R),pe=E(),X=d("p"),se=d("span"),z=w(re),G=w(":"),ie=E(),q=d("span"),Ie=w(_e),O=E(),ce=d("p"),J=d("span"),k=w(be),B=w(":"),Y=E(),ue=d("span"),le=w(ye),we=E(),ne=d("p"),Z=d("span"),at=w(De),Pt=w(":"),xt=E(),Oe=d("span"),ot=w(Qe),Vt=E(),Ne=d("div"),Ue=d("h3"),rt=w(Xe),St=E(),de=d("div"),Ae=d("p"),Ce=d("span"),it=w(Ye),Tt=w(":"),Bt=E(),ze=d("span"),ct=w(Ze),Mt=E(),Pe=d("p"),xe=d("span"),ut=w($e),Ft=w(":"),Lt=E(),We=d("span"),dt=w(et),jt=E(),Ve=d("p"),Se=d("span"),ft=w(tt),Ht=w(":"),Ot=E(),Re=d("span"),mt=w(st),Ut=E(),Ge=d("div"),Te=d("div"),ae.c(),zt=E(),he=d("div"),Be=d("h3"),Be.textContent=ns,Wt=E(),oe.c(),Rt=E(),ve=d("div"),Me=d("h3"),Me.textContent=as,Gt=E(),ee.c(),this.h()},l(_){e=f(_,"DIV",{class:!0});var N=m(e);n=f(N,"DIV",{class:!0});var te=m(n);s=f(te,"DIV",{class:!0});var _t=m(s);K&&K.l(_t),i=I(_t),c=f(_t,"SPAN",{class:!0});var us=m(c);h=D(us,l),us.forEach(r),_t.forEach(r),u=I(te),g=f(te,"DIV",{class:!0});var ht=m(g);y=f(ht,"DIV",{});var vt=m(y);T=f(vt,"H3",{class:!0});var ds=m(T);x=D(ds,P),ds.forEach(r),C=I(vt),V=f(vt,"DIV",{class:!0});var Ee=m(V);j=f(Ee,"P",{});var gt=m(j);W=f(gt,"SPAN",{class:!0});var Jt=m(W);v=D(Jt,M),b=D(Jt,":"),Jt.forEach(r),A=I(gt),H=f(gt,"SPAN",{class:!0});var fs=m(H);ge=D(fs,R),fs.forEach(r),gt.forEach(r),pe=I(Ee),X=f(Ee,"P",{});var bt=m(X);se=f(bt,"SPAN",{class:!0});var Kt=m(se);z=D(Kt,re),G=D(Kt,":"),Kt.forEach(r),ie=I(bt),q=f(bt,"SPAN",{class:!0});var ms=m(q);Ie=D(ms,_e),ms.forEach(r),bt.forEach(r),O=I(Ee),ce=f(Ee,"P",{});var yt=m(ce);J=f(yt,"SPAN",{class:!0});var Qt=m(J);k=D(Qt,be),B=D(Qt,":"),Qt.forEach(r),Y=I(yt),ue=f(yt,"SPAN",{class:!0});var ps=m(ue);le=D(ps,ye),ps.forEach(r),yt.forEach(r),we=I(Ee),ne=f(Ee,"P",{});var wt=m(ne);Z=f(wt,"SPAN",{class:!0});var Xt=m(Z);at=D(Xt,De),Pt=D(Xt,":"),Xt.forEach(r),xt=I(wt),Oe=f(wt,"SPAN",{class:!0});var _s=m(Oe);ot=D(_s,Qe),_s.forEach(r),wt.forEach(r),Ee.forEach(r),vt.forEach(r),Vt=I(ht),Ne=f(ht,"DIV",{});var Dt=m(Ne);Ue=f(Dt,"H3",{class:!0});var hs=m(Ue);rt=D(hs,Xe),hs.forEach(r),St=I(Dt),de=f(Dt,"DIV",{class:!0});var qe=m(de);Ae=f(qe,"P",{});var kt=m(Ae);Ce=f(kt,"SPAN",{class:!0});var Yt=m(Ce);it=D(Yt,Ye),Tt=D(Yt,":"),Yt.forEach(r),Bt=I(kt),ze=f(kt,"SPAN",{class:!0});var vs=m(ze);ct=D(vs,Ze),vs.forEach(r),kt.forEach(r),Mt=I(qe),Pe=f(qe,"P",{});var Et=m(Pe);xe=f(Et,"SPAN",{class:!0});var Zt=m(xe);ut=D(Zt,$e),Ft=D(Zt,":"),Zt.forEach(r),Lt=I(Et),We=f(Et,"SPAN",{class:!0});var gs=m(We);dt=D(gs,et),gs.forEach(r),Et.forEach(r),jt=I(qe),Ve=f(qe,"P",{});var It=m(Ve);Se=f(It,"SPAN",{class:!0});var $t=m(Se);ft=D($t,tt),Ht=D($t,":"),$t.forEach(r),Ot=I(It),Re=f(It,"SPAN",{class:!0});var bs=m(Re);mt=D(bs,st),bs.forEach(r),It.forEach(r),qe.forEach(r),Dt.forEach(r),ht.forEach(r),Ut=I(te),Ge=f(te,"DIV",{class:!0});var ys=m(Ge);Te=f(ys,"DIV",{class:!0});var ws=m(Te);ae.l(ws),ws.forEach(r),ys.forEach(r),zt=I(te),he=f(te,"DIV",{class:!0});var Nt=m(he);Be=f(Nt,"H3",{class:!0,"data-svelte-h":!0}),me(Be)!=="svelte-m4jft4"&&(Be.textContent=ns),Wt=I(Nt),oe.l(Nt),Nt.forEach(r),te.forEach(r),Rt=I(N),ve=f(N,"DIV",{class:!0});var At=m(ve);Me=f(At,"H3",{class:!0,"data-svelte-h":!0}),me(Me)!=="svelte-vd9ius"&&(Me.textContent=as),Gt=I(At),ee.l(At),At.forEach(r),N.forEach(r),this.h()},h(){o(c,"class",p="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold shadow-sm "+(a[1].status==="ACTIVE"?"bg-green-100 text-green-800":a[1].status==="FINISHED"?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800")),o(s,"class","flex flex-col md:flex-row md:justify-between md:items-start mb-6 gap-4"),o(T,"class","font-semibold text-lg mb-3 text-gray-800"),o(W,"class","text-gray-500"),o(H,"class","font-medium"),o(se,"class","text-gray-500"),o(q,"class","font-medium"),o(J,"class","text-gray-500"),o(ue,"class","font-medium"),o(Z,"class","text-gray-500"),o(Oe,"class","font-medium"),o(V,"class","space-y-2 text-gray-700"),o(Ue,"class","font-semibold text-lg mb-3 text-gray-800"),o(Ce,"class","text-gray-500"),o(ze,"class","font-medium"),o(xe,"class","text-gray-500"),o(We,"class","font-medium"),o(Se,"class","text-gray-500"),o(Re,"class","font-medium"),o(de,"class","space-y-2 text-gray-700"),o(g,"class","grid md:grid-cols-2 gap-8 mb-8"),o(Te,"class","w-full bg-gray-200 rounded-full h-4"),o(Ge,"class","mb-8"),o(Be,"class","font-semibold text-lg mb-3 text-gray-800"),o(he,"class","mt-8 pt-8 border-t border-gray-100"),o(n,"class","bg-white rounded-xl shadow-lg p-8"),o(Me,"class","text-xl font-bold mb-6 text-gray-900"),o(ve,"class","bg-white rounded-xl shadow-lg p-8"),o(e,"class","grid gap-8")},m(_,N){U(_,e,N),t(e,n),t(n,s),K&&K.m(s,null),t(s,i),t(s,c),t(c,h),t(n,u),t(n,g),t(g,y),t(y,T),t(T,x),t(y,C),t(y,V),t(V,j),t(j,W),t(W,v),t(W,b),t(j,A),t(j,H),t(H,ge),t(V,pe),t(V,X),t(X,se),t(se,z),t(se,G),t(X,ie),t(X,q),t(q,Ie),t(V,O),t(V,ce),t(ce,J),t(J,k),t(J,B),t(ce,Y),t(ce,ue),t(ue,le),t(V,we),t(V,ne),t(ne,Z),t(Z,at),t(Z,Pt),t(ne,xt),t(ne,Oe),t(Oe,ot),t(g,Vt),t(g,Ne),t(Ne,Ue),t(Ue,rt),t(Ne,St),t(Ne,de),t(de,Ae),t(Ae,Ce),t(Ce,it),t(Ce,Tt),t(Ae,Bt),t(Ae,ze),t(ze,ct),t(de,Mt),t(de,Pe),t(Pe,xe),t(xe,ut),t(xe,Ft),t(Pe,Lt),t(Pe,We),t(We,dt),t(de,jt),t(de,Ve),t(Ve,Se),t(Se,ft),t(Se,Ht),t(Ve,Ot),t(Ve,Re),t(Re,mt),t(n,Ut),t(n,Ge),t(Ge,Te),ae.m(Te,null),t(n,zt),t(n,he),t(he,Be),t(he,Wt),oe.m(he,null),t(e,Rt),t(e,ve),t(ve,Me),t(ve,Gt),ke[$].m(ve,null),F=!0},p(_,N){_[2]?K?K.p(_,N):(K=Ns(_),K.c(),K.m(s,i)):K&&(K.d(1),K=null),(!F||N&2)&&l!==(l=_[1].status+"")&&S(h,l),(!F||N&2&&p!==(p="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold shadow-sm "+(_[1].status==="ACTIVE"?"bg-green-100 text-green-800":_[1].status==="FINISHED"?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800")))&&o(c,"class",p),(!F||N&64)&&P!==(P=_[6]("cession.loan_details")+"")&&S(x,P),(!F||N&64)&&M!==(M=_[6]("cession.total_amount")+"")&&S(v,M),(!F||N&2)&&R!==(R=fe(_[1].totalLoanAmount)+"")&&S(ge,R),(!F||N&64)&&re!==(re=_[6]("cession.monthly_payment")+"")&&S(z,re),(!F||N&2)&&_e!==(_e=fe(_[1].monthlyDeduction)+"")&&S(Ie,_e),(!F||N&64)&&be!==(be=_[6]("cession.remaining_balance")+"")&&S(k,be),(!F||N&2)&&ye!==(ye=fe(_[1].remainingBalance)+"")&&S(le,ye),(!F||N&64)&&De!==(De=_[6]("cession.bank_agency")+"")&&S(at,De),(!F||N&2)&&Qe!==(Qe=_[1].bankOrAgency+"")&&S(ot,Qe),(!F||N&64)&&Xe!==(Xe=_[6]("cession.payment_schedule")+"")&&S(rt,Xe),(!F||N&64)&&Ye!==(Ye=_[6]("cession.start_date")+"")&&S(it,Ye),(!F||N&2)&&Ze!==(Ze=_[9](_[1].startDate)+"")&&S(ct,Ze),(!F||N&64)&&$e!==($e=_[6]("cession.end_date")+"")&&S(ut,$e),(!F||N&2)&&et!==(et=_[9](_[1].endDate)+"")&&S(dt,et),(!F||N&64)&&tt!==(tt=_[6]("cession.expected_payoff")+"")&&S(ft,tt),(!F||N&2)&&st!==(st=_[9](_[1].expectedPayoffDate)+"")&&S(mt,st),Fe===(Fe=os(_))&&ae?ae.p(qt(_,Fe),N):(ae.d(1),ae=Fe(qt(_,Fe)),ae&&(ae.c(),ae.m(Te,null))),pt===(pt=rs(_))&&oe?oe.p(_,N):(oe.d(1),oe=pt(_),oe&&(oe.c(),oe.m(he,null)));let te=$;$=cs(_),$===te?ke[$].p(_,N):(ls(),je(ke[te],1,1,()=>{ke[te]=null}),ss(),ee=ke[$],ee?ee.p(_,N):(ee=ke[$]=is[$](_),ee.c()),He(ee,1),ee.m(ve,null))},i(_){F||(He(ee),F=!0)},o(_){je(ee),F=!1},d(_){_&&r(e),K&&K.d(),ae.d(),oe.d(),ke[$].d()}}}function Xs(a){let e,n='<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-primary-600"></div>';return{c(){e=d("div"),e.innerHTML=n,this.h()},l(s){e=f(s,"DIV",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-rf7y49"&&(e.innerHTML=n),this.h()},h(){o(e,"class","flex justify-center items-center py-16")},m(s,i){U(s,e,i)},p:Q,i:Q,o:Q,d(s){s&&r(e)}}}function Ns(a){let e,n,s=a[2].fullName+"",i,c,l,h,p,u=a[2].cin+"",g;return{c(){e=d("div"),n=d("h2"),i=w(s),c=E(),l=d("p"),h=w("CIN: "),p=d("span"),g=w(u),this.h()},l(y){e=f(y,"DIV",{});var T=m(e);n=f(T,"H2",{class:!0});var P=m(n);i=D(P,s),P.forEach(r),c=I(T),l=f(T,"P",{class:!0});var x=m(l);h=D(x,"CIN: "),p=f(x,"SPAN",{class:!0});var C=m(p);g=D(C,u),C.forEach(r),x.forEach(r),T.forEach(r),this.h()},h(){o(n,"class","text-2xl font-bold mb-1 text-gray-900"),o(p,"class","font-medium"),o(l,"class","text-gray-500")},m(y,T){U(y,e,T),t(e,n),t(n,i),t(e,c),t(e,l),t(l,h),t(l,p),t(p,g)},p(y,T){T&4&&s!==(s=y[2].fullName+"")&&S(i,s),T&4&&u!==(u=y[2].cin+"")&&S(g,u)},d(y){y&&r(e)}}}function Ys(a){let e,n="Payment progress unavailable";return{c(){e=d("p"),e.textContent=n,this.h()},l(s){e=f(s,"P",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-o4gyze"&&(e.textContent=n),this.h()},h(){o(e,"class","text-sm text-gray-500 mt-1")},m(s,i){U(s,e,i)},p:Q,d(s){s&&r(e)}}}function As(a){let e,n,s,i,c=Math.round(a[17])+"",l,h;return{c(){e=d("div"),s=E(),i=d("p"),l=w(c),h=w("% paid"),this.h()},l(p){e=f(p,"DIV",{class:!0,style:!0}),m(e).forEach(r),s=I(p),i=f(p,"P",{class:!0});var u=m(i);l=D(u,c),h=D(u,"% paid"),u.forEach(r),this.h()},h(){o(e,"class","bg-primary-600 h-4 rounded-full transition-all duration-300"),o(e,"style",n=`width: ${a[17]}%`),o(i,"class","text-sm text-gray-600 mt-1 font-medium")},m(p,u){U(p,e,u),U(p,s,u),U(p,i,u),t(i,l),t(i,h)},p(p,u){u&2&&n!==(n=`width: ${p[17]}%`)&&o(e,"style",n),u&2&&c!==(c=Math.round(p[17])+"")&&S(l,c)},d(p){p&&(r(e),r(s),r(i))}}}function Zs(a){let e,n,s="Upload Cession Contract (PDF only)",i,c,l,h;return{c(){e=d("div"),n=d("p"),n.textContent=s,i=E(),c=d("input"),this.h()},l(p){e=f(p,"DIV",{class:!0});var u=m(e);n=f(u,"P",{class:!0,"data-svelte-h":!0}),me(n)!=="svelte-csds72"&&(n.textContent=s),i=I(u),c=f(u,"INPUT",{type:!0,accept:!0,class:!0}),u.forEach(r),this.h()},h(){o(n,"class","text-sm text-gray-500 mb-2"),o(c,"type","file"),o(c,"accept","application/pdf"),o(c,"class","text-sm"),c.disabled=a[5],o(e,"class","border border-dashed border-gray-300 rounded-md p-4 bg-gray-50")},m(p,u){U(p,e,u),t(e,n),t(e,i),t(e,c),l||(h=Ct(c,"change",a[7]),l=!0)},p(p,u){u&32&&(c.disabled=p[5])},d(p){p&&r(e),l=!1,h()}}}function $s(a){let e,n,s,i="✓ Contract uploaded:",c,l,h=a[4].fileName+"",p,u,g,y,T,P,x,C,V="Delete",j,W;return{c(){e=d("div"),n=d("div"),s=d("span"),s.textContent=i,c=E(),l=d("span"),p=w(h),u=E(),g=d("div"),y=d("a"),T=w("View"),x=E(),C=d("button"),C.textContent=V,this.h()},l(M){e=f(M,"DIV",{class:!0});var v=m(e);n=f(v,"DIV",{});var b=m(n);s=f(b,"SPAN",{class:!0,"data-svelte-h":!0}),me(s)!=="svelte-enhyup"&&(s.textContent=i),c=I(b),l=f(b,"SPAN",{});var A=m(l);p=D(A,h),A.forEach(r),b.forEach(r),u=I(v),g=f(v,"DIV",{class:!0});var H=m(g);y=f(H,"A",{href:!0,target:!0,class:!0});var R=m(y);T=D(R,"View"),R.forEach(r),x=I(H),C=f(H,"BUTTON",{class:!0,"data-svelte-h":!0}),me(C)!=="svelte-m3f2y0"&&(C.textContent=V),H.forEach(r),v.forEach(r),this.h()},h(){o(s,"class","font-medium"),o(y,"href",P=a[4].downloadUrl),o(y,"target","_blank"),o(y,"class","text-primary-600 hover:text-primary-800 text-sm font-medium underline"),o(C,"class","text-red-600 hover:text-red-800 text-sm font-medium underline"),o(g,"class","flex space-x-2 mt-2 md:mt-0"),o(e,"class","bg-green-50 text-green-700 p-4 rounded flex flex-col md:flex-row justify-between items-center gap-2")},m(M,v){U(M,e,v),t(e,n),t(n,s),t(n,c),t(n,l),t(l,p),t(e,u),t(e,g),t(g,y),t(y,T),t(g,x),t(g,C),j||(W=Ct(C,"click",a[12]),j=!0)},p(M,v){v&16&&h!==(h=M[4].fileName+"")&&S(p,h),v&16&&P!==(P=M[4].downloadUrl)&&o(y,"href",P)},d(M){M&&r(e),j=!1,W()}}}function el(a){let e,n="Loading payment information...";return{c(){e=d("p"),e.textContent=n,this.h()},l(s){e=f(s,"P",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-4ib4mu"&&(e.textContent=n),this.h()},h(){o(e,"class","text-gray-500")},m(s,i){U(s,e,i)},p:Q,i:Q,o:Q,d(s){s&&r(e)}}}function tl(a){let e,n="Cannot load payments: Invalid cession ID";return{c(){e=d("p"),e.textContent=n,this.h()},l(s){e=f(s,"P",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-2mx0ds"&&(e.textContent=n),this.h()},h(){o(e,"class","text-red-500")},m(s,i){U(s,e,i)},p:Q,i:Q,o:Q,d(s){s&&r(e)}}}function sl(a){let e,n;return e=new zs({props:{cessionId:a[1].id,remainingBalance:a[1].remainingBalance||0,totalLoanAmount:a[1].totalLoanAmount||0}}),{c(){Fs(e.$$.fragment)},l(s){Ls(e.$$.fragment,s)},m(s,i){js(e,s,i),n=!0},p(s,i){const c={};i&2&&(c.cessionId=s[1].id),i&2&&(c.remainingBalance=s[1].remainingBalance||0),i&2&&(c.totalLoanAmount=s[1].totalLoanAmount||0),e.$set(c)},i(s){n||(He(e.$$.fragment,s),n=!0)},o(s){je(e.$$.fragment,s),n=!1},d(s){Hs(e,s)}}}function ll(a){let e,n,s,i,c;const l=[Js,qs],h=[];function p(u,g){return u[3]?0:1}return s=p(a),i=h[s]=l[s](a),{c(){e=E(),n=d("div"),i.c(),this.h()},l(u){e=I(u),n=f(u,"DIV",{class:!0});var g=m(n);i.l(g),g.forEach(r),this.h()},h(){o(n,"class","max-w-5xl mx-auto px-4 py-8")},m(u,g){U(u,e,g),U(u,n,g),h[s].m(n,null),c=!0},p(u,[g]){let y=s;s=p(u),s===y?h[s].p(u,g):(ls(),je(h[y],1,1,()=>{h[y]=null}),ss(),i=h[s],i?i.p(u,g):(i=h[s]=l[s](u),i.c()),He(i,1),i.m(n,null))},i(u){c||(He(i),c=!0)},o(u){je(i),c=!1},d(u){u&&(r(e),r(n)),h[s].d()}}}function fe(a){return a==null?"N/A":new Intl.NumberFormat("ar-TN",{style:"currency",currency:"TND",minimumFractionDigits:3,maximumFractionDigits:3}).format(a)}function Cs(a){const e=["","واحد","اثنان","ثلاثة","أربعة","خمسة","ستة","سبعة","ثمانية","تسعة"],n=["عشرة","أحد عشر","اثنا عشر","ثلاثة عشر","أربعة عشر","خمسة عشر","ستة عشر","سبعة عشر","ثمانية عشر","تسعة عشر"],s=["","","عشرون","ثلاثون","أربعون","خمسون","ستون","سبعون","ثمانون","تسعون"],i=["","مائة","مئتان","ثلاثمائة","أربعمائة","خمسمائة","ستمائة","سبعمائة","ثمانمائة","تسعمائة"],c=["","ألف","مليون","مليار"];if(a===0)return"صفر";let l="",h=0;for(;a>0;){let p=a%1e3;if(p!==0){let u="";if(p>=100&&(u+=i[Math.floor(p/100)]+" ",p%=100),p>0)if(p<10)u+=e[p];else if(p<20)u+=n[p-10];else{let g=p%10,y=Math.floor(p/10);g>0&&(u+=e[g]+" و "),u+=s[y]}h>0&&(u+=" "+c[h]),l?l=u+" و "+l:l=u}a=Math.floor(a/1e3),h++}return l+" دينارا"}function nl(a,e,n){let s,i;Ds(a,Le,v=>n(5,s=v)),Ds(a,Ws,v=>n(6,i=v));let{data:c}=e,l=null,h=null,p=!1,u=null;async function g(v){Je(Le,s=!0,s);try{const b=await(void 0).getById(v);b.success?(n(1,l=b.data),l.client&&l.client.id&&y(l.client.id),l.contractDocumentId&&T(l.contractDocumentId)):(L(b.error||"Failed to load cession","error"),n(3,p=!0),setTimeout(()=>es("/clients"),2e3))}catch(b){L("Error loading cession: "+b.message,"error"),n(3,p=!0),setTimeout(()=>es("/clients"),2e3)}finally{Je(Le,s=!1,s)}}async function y(v){try{const b=await(void 0).getById(v);b.success?n(2,h=b.data):L(b.error||"Failed to load client","error")}catch(b){L("Error loading client: "+b.message,"error")}}async function T(v){try{const b=await(void 0).getById(v);b.success?n(4,u=b.data):L(b.error||"Failed to load contract document","error")}catch(b){L("Error loading contract document: "+b.message,"error")}}async function P(v){const b=v.target.files[0];if(b){if(b.type!=="application/pdf"){L("Only PDF files are allowed.","warning");return}if(!l||!l.id){L("Cannot upload document: Cession not found.","error");return}Je(Le,s=!0,s);try{const A=await(void 0).upload(b,"CESSION_CONTRACT",l.id);A.success?(L("Document uploaded successfully!","success"),await x(l.id,A.data.id),n(4,u=A.data)):L(A.error||"Failed to upload document","error")}catch(A){L("Error uploading document: "+A.message,"error")}finally{Je(Le,s=!1,s)}}}async function x(v,b){try{const A=await(void 0).linkContractDocument(v,b);A.success?L("Contract document linked successfully!","success"):L(A.error||"Failed to link contract document","error")}catch(A){L("Error linking contract document: "+A.message,"error")}}async function C(v){if(confirm("Are you sure you want to delete this document?")){Je(Le,s=!0,s);try{const b=await(void 0).delete(v);b.success?(L("Document deleted successfully!","success"),n(4,u=null),l&&n(1,l.contractDocumentId=null,l)):L(b.error||"Failed to delete document","error")}catch(b){L("Error deleting document: "+b.message,"error")}finally{Je(Le,s=!1,s)}}}function V(v){return v?ts(new Date(v),"dd/MM/yyyy"):"N/A"}async function j(){try{if(!l){L("Cession data not available","error");return}const v={courtName:l.courtName||"",bookNumber:l.bookNumber||"",pageNumber:l.pageNumber||"",date:V(l.createdAt)||V(new Date),supplierTaxId:l.supplierTaxId||"",supplierName:l.supplierName||"",supplierAddress:l.supplierAddress||"",supplierBankAccount:l.supplierBankAccount||"",workerNumber:l.clientNumber||"",fullName:l.clientName||(h?h.fullName:""),cin:l.clientCin||(h?h.cin:""),address:l.clientAddress||(h?h.address:""),workplace:l.clientWorkplace||"",jobTitle:l.clientJob||"",bankAccountNumber:l.bankOrAgency||"",itemDescription:l.itemDescription||"",amountInWords:Cs(l.totalLoanAmount),totalAmountNumeric:fe(l.totalLoanAmount),monthlyPayment:fe(l.monthlyDeduction),firstDeductionMonthArabic:l.startDate?ts(new Date(l.startDate),"MMMM yyyy",{locale:Es}):""};await Os(v)}catch(v){L("حدث خطأ أثناء معاينة المستند: "+v.message,"error")}}async function W(){try{if(!l){L("Cession data not available","error");return}const v={courtName:l.courtName||"",bookNumber:l.bookNumber||"",pageNumber:l.pageNumber||"",date:V(l.createdAt)||V(new Date),supplierTaxId:l.supplierTaxId||"",supplierName:l.supplierName||"",supplierAddress:l.supplierAddress||"",supplierBankAccount:l.supplierBankAccount||"",workerNumber:l.clientNumber||"",fullName:l.clientName||(h?h.fullName:""),cin:l.clientCin||(h?h.cin:""),address:l.clientAddress||(h?h.address:""),workplace:l.clientWorkplace||"",jobTitle:l.clientJob||"",bankAccountNumber:l.bankOrAgency||"",itemDescription:l.itemDescription||"",amountInWords:Cs(l.totalLoanAmount),totalAmountNumeric:fe(l.totalLoanAmount),monthlyPayment:fe(l.monthlyDeduction),firstDeductionMonthArabic:l.startDate?ts(new Date(l.startDate),"MMMM yyyy",{locale:Es}):""};await Us(v,`salary_assignment_${l.id}.pdf`)}catch(v){L("حدث خطأ أثناء تحميل المستند: "+v.message,"error")}}const M=()=>C(u.id);return a.$$set=v=>{"data"in v&&n(0,c=v.data)},a.$$.update=()=>{a.$$.dirty&1&&c&&(c.clientId&&c.cessionId?g(c.cessionId):(n(3,p=!0),L("Invalid client or cession ID","error"),setTimeout(()=>es("/clients"),2e3)))},[c,l,h,p,u,s,i,P,C,V,j,W,M]}class hl extends Bs{constructor(e){super(),Ms(this,e,nl,ll,Ss,{data:0})}}export{hl as component,_l as universal};
