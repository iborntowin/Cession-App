import{s as Ee,a as P,f as u,l as W,J as Ae,d as b,c as k,g as d,h as N,m as X,j as l,i as x,w as e,n as te,I as me,u as Pe,o as ke,A as re,y as F,R as ue,P as Ne,N as U,z as K,Q as Le,H as we,x as Oe,O as Ie}from"../chunks/scheduler.fb6ad399.js";import{S as Te,i as Ve}from"../chunks/index.19f0e15d.js";import{c as Be,b as he}from"../chunks/api.b4688d57.js";import{s as J,l as ee}from"../chunks/navigation.68a3d764.js";function De(s){let n,t,i="Client Information",c,r,a,p,D="Full Name",E,h,A=s[1].fullName+"",L,v,y,m,g="CIN (ID Number)",f,q,C=s[1].cin+"",w;return{c(){n=u("div"),t=u("h2"),t.textContent=i,c=P(),r=u("div"),a=u("div"),p=u("p"),p.textContent=D,E=P(),h=u("p"),L=W(A),v=P(),y=u("div"),m=u("p"),m.textContent=g,f=P(),q=u("p"),w=W(C),this.h()},l(o){n=d(o,"DIV",{class:!0});var _=N(n);t=d(_,"H2",{class:!0,"data-svelte-h":!0}),F(t)!=="svelte-27hnvw"&&(t.textContent=i),c=k(_),r=d(_,"DIV",{class:!0});var B=N(r);a=d(B,"DIV",{});var M=N(a);p=d(M,"P",{class:!0,"data-svelte-h":!0}),F(p)!=="svelte-y4vv6"&&(p.textContent=D),E=k(M),h=d(M,"P",{class:!0});var O=N(h);L=X(O,A),O.forEach(b),M.forEach(b),v=k(B),y=d(B,"DIV",{});var H=N(y);m=d(H,"P",{class:!0,"data-svelte-h":!0}),F(m)!=="svelte-z48v35"&&(m.textContent=g),f=k(H),q=d(H,"P",{class:!0});var j=N(q);w=X(j,C),j.forEach(b),H.forEach(b),B.forEach(b),_.forEach(b),this.h()},h(){l(t,"class","text-lg font-semibold mb-2"),l(p,"class","text-sm text-gray-500"),l(h,"class","font-medium"),l(m,"class","text-sm text-gray-500"),l(q,"class","font-medium"),l(r,"class","grid grid-cols-2 gap-4"),l(n,"class","card mb-6")},m(o,_){x(o,n,_),e(n,t),e(n,c),e(n,r),e(r,a),e(a,p),e(a,E),e(a,h),e(h,L),e(r,v),e(r,y),e(y,m),e(y,f),e(y,q),e(q,w)},p(o,_){_&2&&A!==(A=o[1].fullName+"")&&te(L,A),_&2&&C!==(C=o[1].cin+"")&&te(w,C)},d(o){o&&b(n)}}}function Se(s){let n,t,i,c,r="Bank / Agency",a,p,D,E,h,A="Total Loan Amount (TND)",L,v,y,m,g,f="Monthly Payment (TND)",q,C,w,o,_,B="Start Date",M,O,H,j,G,ve="End Date (Optional)",de,z,ce,Q,_e="If not provided, will be calculated based on monthly payment.",fe,ae,Y,R,$=s[4]?"Saving...":s[3]?"Update Cession":"Create Cession",le,pe,be,V=s[3]&&ge(s);return{c(){n=u("div"),t=u("form"),i=u("div"),c=u("label"),c.textContent=r,a=P(),p=u("input"),D=P(),E=u("div"),h=u("label"),h.textContent=A,L=P(),v=u("input"),y=P(),m=u("div"),g=u("label"),g.textContent=f,q=P(),C=u("input"),w=P(),o=u("div"),_=u("label"),_.textContent=B,M=P(),O=u("input"),H=P(),j=u("div"),G=u("label"),G.textContent=ve,de=P(),z=u("input"),ce=P(),Q=u("p"),Q.textContent=_e,fe=P(),V&&V.c(),ae=P(),Y=u("div"),R=u("button"),le=W($),this.h()},l(I){n=d(I,"DIV",{class:!0});var T=N(n);t=d(T,"FORM",{class:!0});var S=N(t);i=d(S,"DIV",{});var se=N(i);c=d(se,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),F(c)!=="svelte-1wuwyg5"&&(c.textContent=r),a=k(se),p=d(se,"INPUT",{id:!0,type:!0,class:!0,placeholder:!0}),se.forEach(b),D=k(S),E=d(S,"DIV",{});var ne=N(E);h=d(ne,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),F(h)!=="svelte-7ikeng"&&(h.textContent=A),L=k(ne),v=d(ne,"INPUT",{id:!0,type:!0,step:!0,min:!0,class:!0,placeholder:!0}),ne.forEach(b),y=k(S),m=d(S,"DIV",{});var ie=N(m);g=d(ie,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),F(g)!=="svelte-cax8hs"&&(g.textContent=f),q=k(ie),C=d(ie,"INPUT",{id:!0,type:!0,step:!0,min:!0,class:!0,placeholder:!0}),ie.forEach(b),w=k(S),o=d(S,"DIV",{});var oe=N(o);_=d(oe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),F(_)!=="svelte-120kl51"&&(_.textContent=B),M=k(oe),O=d(oe,"INPUT",{id:!0,type:!0,class:!0}),oe.forEach(b),H=k(S),j=d(S,"DIV",{});var Z=N(j);G=d(Z,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),F(G)!=="svelte-oadfmg"&&(G.textContent=ve),de=k(Z),z=d(Z,"INPUT",{id:!0,type:!0,class:!0}),ce=k(Z),Q=d(Z,"P",{class:!0,"data-svelte-h":!0}),F(Q)!=="svelte-1fqw6pa"&&(Q.textContent=_e),Z.forEach(b),fe=k(S),V&&V.l(S),ae=k(S),Y=d(S,"DIV",{class:!0});var Ce=N(Y);R=d(Ce,"BUTTON",{type:!0,class:!0});var ye=N(R);le=X(ye,$),ye.forEach(b),Ce.forEach(b),S.forEach(b),T.forEach(b),this.h()},h(){l(c,"for","bankOrAgency"),l(c,"class","label"),l(p,"id","bankOrAgency"),l(p,"type","text"),l(p,"class","input"),l(p,"placeholder","Enter bank or agency name"),p.disabled=s[4],p.required=!0,l(h,"for","totalLoanAmount"),l(h,"class","label"),l(v,"id","totalLoanAmount"),l(v,"type","number"),l(v,"step","0.01"),l(v,"min","0"),l(v,"class","input"),l(v,"placeholder","Enter total loan amount"),v.disabled=s[4],v.required=!0,l(g,"for","monthlyPayment"),l(g,"class","label"),l(C,"id","monthlyPayment"),l(C,"type","number"),l(C,"step","0.01"),l(C,"min","0"),l(C,"class","input"),l(C,"placeholder","Enter monthly payment amount"),C.disabled=s[4],C.required=!0,l(_,"for","startDate"),l(_,"class","label"),l(O,"id","startDate"),l(O,"type","date"),l(O,"class","input"),O.disabled=s[4],O.required=!0,l(G,"for","endDate"),l(G,"class","label"),l(z,"id","endDate"),l(z,"type","date"),l(z,"class","input"),z.disabled=s[4],l(Q,"class","text-sm text-gray-500 mt-1"),l(R,"type","submit"),l(R,"class","btn btn-primary"),R.disabled=s[4],l(Y,"class","pt-4"),l(t,"class","space-y-4"),l(n,"class","card max-w-2xl")},m(I,T){x(I,n,T),e(n,t),e(t,i),e(i,c),e(i,a),e(i,p),U(p,s[2].bankOrAgency),e(t,D),e(t,E),e(E,h),e(E,L),e(E,v),U(v,s[2].totalLoanAmount),e(t,y),e(t,m),e(m,g),e(m,q),e(m,C),U(C,s[2].monthlyPayment),e(t,w),e(t,o),e(o,_),e(o,M),e(o,O),U(O,s[2].startDate),e(t,H),e(t,j),e(j,G),e(j,de),e(j,z),U(z,s[2].endDate),e(j,ce),e(j,Q),e(t,fe),V&&V.m(t,null),e(t,ae),e(t,Y),e(Y,R),e(R,le),pe||(be=[K(p,"input",s[6]),K(v,"input",s[7]),K(C,"input",s[8]),K(O,"input",s[9]),K(z,"input",s[10]),K(t,"submit",Le(s[5]))],pe=!0)},p(I,T){T&16&&(p.disabled=I[4]),T&4&&p.value!==I[2].bankOrAgency&&U(p,I[2].bankOrAgency),T&16&&(v.disabled=I[4]),T&4&&ue(v.value)!==I[2].totalLoanAmount&&U(v,I[2].totalLoanAmount),T&16&&(C.disabled=I[4]),T&4&&ue(C.value)!==I[2].monthlyPayment&&U(C,I[2].monthlyPayment),T&16&&(O.disabled=I[4]),T&4&&U(O,I[2].startDate),T&16&&(z.disabled=I[4]),T&4&&U(z,I[2].endDate),I[3]?V?V.p(I,T):(V=ge(I),V.c(),V.m(t,ae)):V&&(V.d(1),V=null),T&24&&$!==($=I[4]?"Saving...":I[3]?"Update Cession":"Create Cession")&&te(le,$),T&16&&(R.disabled=I[4])},d(I){I&&b(n),V&&V.d(),pe=!1,we(be)}}}function Fe(s){let n,t="<p>Loading cession details...</p>";return{c(){n=u("div"),n.innerHTML=t,this.h()},l(i){n=d(i,"DIV",{class:!0,"data-svelte-h":!0}),F(n)!=="svelte-1m7tzlz"&&(n.innerHTML=t),this.h()},h(){l(n,"class","text-center py-8")},m(i,c){x(i,n,c)},p:me,d(i){i&&b(n)}}}function ge(s){let n,t,i="Status",c,r,a,p="Active",D,E="Finished",h,A="Pending",L,v;return{c(){n=u("div"),t=u("label"),t.textContent=i,c=P(),r=u("select"),a=u("option"),a.textContent=p,D=u("option"),D.textContent=E,h=u("option"),h.textContent=A,this.h()},l(y){n=d(y,"DIV",{});var m=N(n);t=d(m,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),F(t)!=="svelte-19v8fir"&&(t.textContent=i),c=k(m),r=d(m,"SELECT",{id:!0,class:!0});var g=N(r);a=d(g,"OPTION",{"data-svelte-h":!0}),F(a)!=="svelte-194sq3m"&&(a.textContent=p),D=d(g,"OPTION",{"data-svelte-h":!0}),F(D)!=="svelte-bwgjce"&&(D.textContent=E),h=d(g,"OPTION",{"data-svelte-h":!0}),F(h)!=="svelte-1tnqpsc"&&(h.textContent=A),g.forEach(b),m.forEach(b),this.h()},h(){l(t,"for","status"),l(t,"class","label"),a.__value="ACTIVE",U(a,a.__value),D.__value="FINISHED",U(D,D.__value),h.__value="PENDING",U(h,h.__value),l(r,"id","status"),l(r,"class","input"),r.disabled=s[4],s[2].status===void 0&&Oe(()=>s[11].call(r))},m(y,m){x(y,n,m),e(n,t),e(n,c),e(n,r),e(r,a),e(r,D),e(r,h),Ie(r,s[2].status,!0),L||(v=K(r,"change",s[11]),L=!0)},p(y,m){m&16&&(r.disabled=y[4]),m&4&&Ie(r,y[2].status)},d(y){y&&b(n),L=!1,v()}}}function qe(s){let n,t,i,c,r,a,p=s[3]?"Back to Cession Details":"Back to Cessions",D,E,h,A,L=s[3]?"Edit":"New",v,y,m,g;document.title=n=(s[3]?"Edit":"New")+" Cession | Cession Management";let f=s[1]&&De(s);function q(o,_){return o[4]&&o[3]&&!o[2].bankOrAgency?Fe:Se}let C=q(s),w=C(s);return{c(){t=P(),i=u("div"),c=u("div"),r=u("a"),a=W("← "),D=W(p),h=P(),A=u("h1"),v=W(L),y=W(" Cession"),m=P(),f&&f.c(),g=P(),w.c(),this.h()},l(o){Ae("svelte-xjtjal",document.head).forEach(b),t=k(o),i=d(o,"DIV",{});var B=N(i);c=d(B,"DIV",{class:!0});var M=N(c);r=d(M,"A",{href:!0,class:!0});var O=N(r);a=X(O,"← "),D=X(O,p),O.forEach(b),h=k(M),A=d(M,"H1",{class:!0});var H=N(A);v=X(H,L),y=X(H," Cession"),H.forEach(b),M.forEach(b),m=k(B),f&&f.l(B),g=k(B),w.l(B),B.forEach(b),this.h()},h(){l(r,"href",E=s[3]?`/clients/${s[0].clientId}/cessions/${s[0].cessionId}`:`/clients/${s[0].clientId}/cessions`),l(r,"class","text-primary-600 hover:text-primary-800 mb-2 inline-block"),l(A,"class","text-2xl font-bold text-gray-800"),l(c,"class","mb-6")},m(o,_){x(o,t,_),x(o,i,_),e(i,c),e(c,r),e(r,a),e(r,D),e(c,h),e(c,A),e(A,v),e(A,y),e(i,m),f&&f.m(i,null),e(i,g),w.m(i,null)},p(o,[_]){_&8&&n!==(n=(o[3]?"Edit":"New")+" Cession | Cession Management")&&(document.title=n),_&8&&p!==(p=o[3]?"Back to Cession Details":"Back to Cessions")&&te(D,p),_&9&&E!==(E=o[3]?`/clients/${o[0].clientId}/cessions/${o[0].cessionId}`:`/clients/${o[0].clientId}/cessions`)&&l(r,"href",E),_&8&&L!==(L=o[3]?"Edit":"New")&&te(v,L),o[1]?f?f.p(o,_):(f=De(o),f.c(),f.m(i,g)):f&&(f.d(1),f=null),C===(C=q(o))&&w?w.p(o,_):(w.d(1),w=C(o),w&&(w.c(),w.m(i,null)))},i:me,o:me,d(o){o&&(b(t),b(i)),f&&f.d(),w.d()}}}function Me(s,n,t){let i;Pe(s,ee,f=>t(4,i=f));let{data:c}=n,r=null,a={clientId:c.clientId,totalLoanAmount:"",monthlyPayment:"",startDate:new Date().toISOString().split("T")[0],bankOrAgency:"",status:"ACTIVE"},p=!1;ke(async()=>{await D(),c.cessionId!=="new"&&(t(3,p=!0),await E())});async function D(){try{t(1,r=await Be.getById(c.clientId))}catch(f){J(f.message||"Failed to load client details","error")}}async function E(){re(ee,i=!0,i);try{t(2,a=await he.getById(c.cessionId)),a.startDate&&t(2,a.startDate=new Date(a.startDate).toISOString().split("T")[0],a),a.endDate&&t(2,a.endDate=new Date(a.endDate).toISOString().split("T")[0],a)}catch(f){J(f.message||"Failed to load cession details","error")}finally{re(ee,i=!1,i)}}async function h(){if(!a.totalLoanAmount||!a.monthlyPayment||!a.startDate||!a.bankOrAgency){J("Please fill in all required fields","error");return}if(isNaN(parseFloat(a.totalLoanAmount))||isNaN(parseFloat(a.monthlyPayment))){J("Amount and monthly payment must be valid numbers","error");return}if(parseFloat(a.monthlyPayment)>=parseFloat(a.totalLoanAmount)){J("Monthly payment must be less than the total loan amount","error");return}re(ee,i=!0,i);try{if(p)await he.update(c.cessionId,a),J("Cession updated successfully","success");else{const f=await he.create(a);J("Cession created successfully","success"),window.location.href=`/clients/${c.clientId}/cessions/${f.id}`}}catch(f){J(f.message||"Failed to save cession","error")}finally{re(ee,i=!1,i)}}function A(){a.bankOrAgency=this.value,t(2,a)}function L(){a.totalLoanAmount=ue(this.value),t(2,a)}function v(){a.monthlyPayment=ue(this.value),t(2,a)}function y(){a.startDate=this.value,t(2,a)}function m(){a.endDate=this.value,t(2,a)}function g(){a.status=Ne(this),t(2,a)}return s.$$set=f=>{"data"in f&&t(0,c=f.data)},[c,r,a,p,i,h,A,L,v,y,m,g]}class Re extends Te{constructor(n){super(),Ve(this,n,Me,qe,Ee,{data:0})}}export{Re as component};
