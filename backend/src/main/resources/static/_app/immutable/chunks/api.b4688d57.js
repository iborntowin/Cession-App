import{s as g,c as w,g as L,t as P,b as y}from"./navigation.68a3d764.js";import{r as $}from"./scheduler.fb6ad399.js";import"./paths.7a59b8f6.js";const F={backendUrl:"http://localhost:8082",apiPrefix:""};function _(){return"http://localhost:8082"}const a=F.backendUrl;let f=!1,m=null;const n=async r=>{const e=r.headers.get("content-type");let s;try{e&&e.includes("application/json")?s=await r.json():s=await r.text()}catch{s=`Server returned an invalid response (Status: ${r.status})`}if(r.status===401||r.status===403)throw f||(f=!0,m&&clearTimeout(m),g("Your session has expired or authentication is required. Please log in again.","error"),w(),L("/login"),m=setTimeout(()=>{f=!1},2e3)),new Error(s?.message||`Authentication failed with status ${r.status}`);if(!r.ok){let t;throw typeof s=="object"&&s.message?t=s.message:typeof s=="string"?s.includes("<!DOCTYPE")||s.includes("<html>")?t=`Server error (${r.status}): The backend service may be unavailable or returning an error page`:t=s:t=`API request failed with status ${r.status}`,g(t,"error"),new Error(t)}return s},o=()=>{const r=$(P);if(!r)throw new Error("No authentication token found");return{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}},I={getAll:async()=>{const r=o(),e=await fetch(`${a}/api/v1/clients`,{headers:r});return n(e)},search:async(r,e,s,t,c,i,u,h)=>{const d=new URLSearchParams;r&&d.append("name",r),e&&d.append("job",e),s&&d.append("clientNumber",s),t&&d.append("cin",t),c&&d.append("phoneNumber",c),i&&d.append("workplace",i),u&&d.append("address",u),h&&d.append("workerNumber",h);const p=await fetch(`${a}/api/v1/clients/search?${d.toString()}`,{headers:o()});return n(p)},getById:async r=>{try{if(!r||r==="undefined")throw new Error("Invalid client ID");const e=await fetch(`${a}/api/v1/clients/${r}`,{headers:o()});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},create:async r=>{try{const e=await fetch(`${a}/api/v1/clients`,{method:"POST",headers:o(),body:JSON.stringify(r)}),s=await n(e);if(!s||!s.id)throw new Error("Invalid response from server: missing client ID");return{success:!0,data:s}}catch(e){return{success:!1,error:e.message}}},update:async(r,e)=>{try{const s=await fetch(`${a}/api/v1/clients/${r}`,{method:"PUT",headers:o(),body:JSON.stringify(e)});return{success:!0,data:await n(s)}}catch(s){return{success:!1,error:s.message}}},delete:async r=>{try{const e=await fetch(`${a}/api/v1/clients/${r}`,{method:"DELETE",headers:o()});return e.status===204?{success:!0}:(await n(e),{success:!0})}catch(e){return{success:!1,error:e.message}}},checkDuplicate:async(r,e)=>{try{const s=new URLSearchParams;r&&s.append("cin",r),e&&s.append("workerNumber",e);const t=await fetch(`${a}/api/v1/clients/check-duplicate?${s.toString()}`,{headers:o()});return{success:!0,data:await n(t)}}catch(s){return{success:!1,error:s.message}}}},v={getAll:async()=>{const r=o(),e=await fetch(`${a}/api/v1/cessions`,{headers:r});return n(e)},search:async(r,e,s,t,c,i,u,h,d)=>{const p=new URLSearchParams;r&&p.append("name",r),e&&p.append("job",e),s&&p.append("clientNumber",s),t&&p.append("clientCin",t.toString()),c&&p.append("status",c),i&&p.append("phoneNumber",i),u&&p.append("workplace",u),h&&p.append("address",h),d&&p.append("jobId",d.toString());const j=await fetch(`${a}/api/v1/cessions/search?${p.toString()}`,{headers:o()});return n(j)},getById:async r=>{const e=await fetch(`${a}/api/v1/cessions/${r}`,{headers:o()});return n(e)},getByClientId:async r=>{const e=await fetch(`${a}/api/v1/cessions/client/${r}`,{headers:o()});return await n(e)},debugByClientId:async r=>{const e=await fetch(`${a}/api/v1/cessions/client/${r}/debug`,{headers:o()});return await n(e)},create:async r=>{try{const e=await fetch(`${a}/api/v1/cessions`,{method:"POST",headers:o(),body:JSON.stringify(r)});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},update:async(r,e)=>{try{const s=await fetch(`${a}/api/v1/cessions/${r}`,{method:"PUT",headers:o(),body:JSON.stringify(e)});return{success:!0,data:await n(s)}}catch(s){return{success:!1,error:s.message}}},delete:async r=>{try{const e=await fetch(`${a}/api/v1/cessions/${r}`,{method:"DELETE",headers:o()});return e.status===204?{success:!0}:(await n(e),{success:!0})}catch(e){return{success:!1,error:e.message}}}},S={login:async(r,e)=>{try{const s=await fetch(`${a}/api/v1/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:r,password:e})}),t=await n(s);return t&&t.token?(y(t.token,{id:t.id,email:t.email,fullName:t.fullName,role:t.role}),{success:!0,data:t}):{success:!1,error:t.message||"Invalid response from server or no token received"}}catch(s){return{success:!1,error:s.message}}},signup:async(r,e,s,t)=>{try{const c=await fetch(`${a}/api/v1/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:r,password:e,firstName:s,lastName:t})}),i=await n(c);return i&&typeof i.token=="string"&&typeof i.email=="string"&&typeof i.fullName=="string"&&typeof i.role=="string"?(y(i.token,{id:i.id,email:i.email,fullName:i.fullName,role:i.role}),{success:!0,data:i}):{success:!1,error:i?.message||"Invalid response structure from server after signup."}}catch(c){return{success:!1,error:c.message||"An unexpected error occurred during signup."}}},logout:()=>(w(),{success:!0}),validateToken:async()=>{try{const r=await fetch(`${a}/api/v1/auth/validate`,{headers:o()}),e=await n(r);return e&&e.user&&y($(P),{id:e.user.id,email:e.user.email,fullName:e.user.fullName,role:e.user.role}),{success:!0}}catch(r){return w(),{success:!1,error:r.message}}}},b={upload:async(r,e,s)=>{try{const t=new FormData;t.append("file",s);const c=o();delete c["Content-Type"];const i=await fetch(`${a}/api/v1/documents/client/${r}/${e}`,{method:"POST",headers:c,body:t});return{success:!0,data:await n(i)}}catch(t){return{success:!1,error:t.message}}},uploadSpecific:async(r,e,s,t)=>{try{const c=new FormData;c.append("file",t),c.append("documentType",s),e&&c.append("clientNumber",e);const i=o();delete i["Content-Type"];const u=await fetch(`${a}/api/v1/documents/client/${r}/specific`,{method:"POST",headers:i,body:c});return{success:!0,data:await n(u)}}catch(c){return{success:!1,error:c.message}}},getByClientId:async r=>{const e=await fetch(`${a}/api/v1/documents/client/${r}`,{headers:o()});return n(e)},getByCessionId:async r=>{const e=await fetch(`${a}/api/v1/documents/cession/${r}`,{headers:o()});return n(e)},delete:async r=>{try{const e=await fetch(`${a}/api/v1/documents/${r}`,{method:"DELETE",headers:o()});return e.status===204?{success:!0}:(await n(e),{success:!0})}catch(e){return{success:!1,error:e.message}}},uploadDocument:async(r,e,s)=>{try{const t=new FormData;t.append("file",r),t.append("type",e),t.append("entityId",s);const c=o();delete c["Content-Type"];const i=await fetch(`${a}/api/v1/documents/upload`,{method:"POST",headers:c,body:t});return{success:!0,data:await n(i)}}catch(t){return{success:!1,error:t.message}}}},E={getAll:async()=>{const r=await fetch(`${a}/api/workplaces`,{headers:o()});return n(r)},create:async r=>{try{const e=await fetch(`${a}/api/workplaces`,{method:"POST",headers:o(),body:JSON.stringify(r)});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},delete:async r=>{try{const e=await fetch(`${a}/api/workplaces/${r}`,{method:"DELETE",headers:o()});return e.status===204?{success:!0}:(await n(e),{success:!0})}catch(e){return{success:!1,error:e.message}}}},C={create:async r=>{try{const e=await fetch(`${a}/api/v1/payments`,{method:"POST",headers:o(),body:JSON.stringify(r)});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},update:async(r,e)=>{try{const s=await fetch(`${a}/api/v1/payments/${r}`,{method:"PUT",headers:o(),body:JSON.stringify(e)});return{success:!0,data:await n(s)}}catch(s){return{success:!1,error:s.message}}},delete:async r=>{try{const e=await fetch(`${a}/api/v1/payments/${r}`,{method:"DELETE",headers:o()});return e.status===204?{success:!0}:(await n(e),{success:!0})}catch(e){return{success:!1,error:e.message}}},getCessionPayments:async r=>{try{const e=await fetch(`${a}/api/v1/payments/cession/${r}`,{headers:o()});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},getPaymentsByDateRange:async(r,e,s)=>{try{if(!r||r==="null"||r==="undefined")throw new Error("Invalid cession ID");const t=new URLSearchParams({startDate:e,endDate:s}),c=await fetch(`${a}/api/v1/payments/cession/${r}/date-range?${t.toString()}`,{headers:o()});return{success:!0,data:await n(c)}}catch(t){return{success:!1,error:t.message}}},getAllPayments:async()=>{try{const r=await fetch(`${a}/api/v1/payments`,{headers:o()}),e=await n(r);return{success:!0,data:Array.isArray(e)?e:[]}}catch(r){return{success:!1,error:r.message}}}},T={getAll:async()=>{const r=await fetch(`${a}/api/jobs`,{headers:o()});return n(r)},create:async r=>{try{const e=await fetch(`${a}/api/jobs`,{method:"POST",headers:o(),body:JSON.stringify(r)});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},delete:async r=>{try{const e=await fetch(`${a}/api/jobs/${r}`,{method:"DELETE",headers:o()});return e.status===204?{success:!0}:(await n(e),{success:!0})}catch(e){return{success:!1,error:e.message}}}},k={getAll:async()=>{try{const r=o(),e=await fetch(`${a}/api/v1/products`,{headers:r});return{success:!0,data:await n(e)}}catch(r){return{success:!1,error:r.message}}},getById:async r=>{try{const e=await fetch(`${a}/api/v1/products/${r}`,{headers:o()});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},create:async r=>{try{const e={...o(),"Content-Type":"application/json"},s=await fetch(`${a}/api/v1/products`,{method:"POST",headers:e,body:JSON.stringify(r)});return{success:!0,data:await n(s)}}catch(e){return{success:!1,error:e.message}}},update:async(r,e)=>{try{const s={...o(),"Content-Type":"application/json"},t=await fetch(`${a}/api/v1/products/${r}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return{success:!0,data:await n(t)}}catch(s){return{success:!1,error:s.message}}},delete:async r=>{try{const e=o(),s=await fetch(`${a}/api/v1/products/${r}`,{method:"DELETE",headers:e});return s.status===204?{success:!0}:(await n(s),{success:!0})}catch(e){return{success:!1,error:e.message}}},search:async r=>{try{const e=o(),s=new URLSearchParams;r&&s.append("query",r);const t=await fetch(`${a}/api/v1/products/search?${s.toString()}`,{method:"GET",headers:{...e,Accept:"application/json"}});if(!t.ok)throw t.status===401?new Error("Authentication failed. Please log in again."):new Error(`Search failed with status: ${t.status}`);return{success:!0,data:await t.json()}}catch(e){return{success:!1,error:e.message}}}},D={getAll:async()=>{try{const r=o(),e=await fetch(`${a}/api/v1/categories`,{headers:r});return{success:!0,data:await n(e)}}catch(r){return{success:!1,error:r.message}}},getById:async r=>{try{const e=await fetch(`${a}/api/v1/categories/${r}`,{headers:o()});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},create:async r=>{try{const e=o(),s=await fetch(`${a}/api/v1/categories`,{method:"POST",headers:e,body:JSON.stringify(r)});return{success:!0,data:await n(s)}}catch(e){return{success:!1,error:e.message}}},update:async(r,e)=>{try{const s=o(),t=await fetch(`${a}/api/v1/categories/${r}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return{success:!0,data:await n(t)}}catch(s){return{success:!1,error:s.message}}},delete:async r=>{try{const e=o(),s=await fetch(`${a}/api/v1/categories/${r}`,{method:"DELETE",headers:e});return s.status===204?{success:!0}:(await n(s),{success:!0})}catch(e){return{success:!1,error:e.message}}}},O={create:async r=>{const e=new URLSearchParams;e.append("productId",r.productId),e.append("quantity",r.quantity),e.append("sellingPrice",r.sellingPrice),r.notes&&e.append("notes",r.notes);const s=o();s["Content-Type"]="application/x-www-form-urlencoded";const t=await fetch(`${a}/api/v1/stock-movements/record`,{method:"POST",headers:s,body:e});if(!t.ok){const c=await t.text();throw new Error(c)}return{success:!0,data:await t.json()}},getRecent:async(r="OUTBOUND",e=5)=>{try{const s=new URLSearchParams;r&&s.append("type",r),s.append("limit",e.toString());const t=o();t.Accept="application/json";const c=await fetch(`${a}/api/v1/stock-movements/recent?${s.toString()}`,{headers:t});if(!c.ok){const u=await c.text();throw new Error(`Failed to fetch stock movements: ${c.status} - ${u}`)}return{success:!0,data:(await c.json()).map(u=>({...u,productName:u.productName||u.product?.name||"Unknown Product",sellingPriceAtSale:u.sellingPriceAtSale||0,purchasePriceAtSale:u.purchasePrice||0,quantity:u.quantity,createdAt:u.createdAt}))}}catch(s){return{success:!1,error:s.message}}}},B={createExpense:async r=>{try{const e=await fetch(`${a}/api/v1/expenses`,{method:"POST",headers:o(),body:JSON.stringify(r)});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},getExpensesByMonth:async(r,e,s)=>{try{const t=await fetch(`${a}/api/v1/expenses?userId=${r}&year=${e}&month=${s}`,{headers:o()});return{success:!0,data:await n(t)}}catch(t){return{success:!1,error:t.message}}},getExpensesByDateRange:async(r,e,s,t=0,c=10)=>{try{const i=await fetch(`${a}/api/v1/expenses/range?userId=${r}&startDate=${e}&endDate=${s}&page=${t}&size=${c}`,{headers:o()});return{success:!0,data:await n(i)}}catch(i){return{success:!1,error:i.message}}},getAllExpenses:async(r,e=0,s=10)=>{try{const t=await fetch(`${a}/api/v1/expenses/all?userId=${r}&page=${e}&size=${s}`,{headers:o()});return{success:!0,data:await n(t)}}catch(t){return{success:!1,error:t.message}}},getExpensesByCategory:async(r,e,s)=>{try{const t=await fetch(`${a}/api/v1/expenses/categories?userId=${r}&year=${e}&month=${s}`,{headers:o()});return{success:!0,data:await n(t)}}catch(t){return{success:!1,error:t.message}}},deleteExpense:async r=>{try{const e=await fetch(`${a}/api/v1/expenses/${r}`,{method:"DELETE",headers:o()});return await n(e),{success:!0}}catch(e){return{success:!1,error:e.message}}},updateExpense:async(r,e)=>{try{const s=await fetch(`${a}/api/v1/expenses/${r}`,{method:"PUT",headers:o(),body:JSON.stringify(e)});return{success:!0,data:await n(s)}}catch(s){return{success:!1,error:s.message}}},createIncome:async r=>{try{const e=await fetch(`${a}/api/v1/incomes`,{method:"POST",headers:o(),body:JSON.stringify(r)});return{success:!0,data:await n(e)}}catch(e){return{success:!1,error:e.message}}},getIncomesByMonth:async(r,e,s)=>{try{const t=await fetch(`${a}/api/v1/incomes?userId=${r}&year=${e}&month=${s}`,{headers:o()});return{success:!0,data:await n(t)}}catch(t){return{success:!1,error:t.message}}},getIncomesByDateRange:async(r,e,s,t=0,c=10)=>{try{const i=await fetch(`${a}/api/v1/incomes/range?userId=${r}&startDate=${e}&endDate=${s}&page=${t}&size=${c}`,{headers:o()});return{success:!0,data:await n(i)}}catch(i){return{success:!1,error:i.message}}},getAllIncomes:async(r,e=0,s=10)=>{try{const t=await fetch(`${a}/api/v1/income/all?userId=${r}&page=${e}&size=${s}`,{headers:o()});return{success:!0,data:await n(t)}}catch(t){return{success:!1,error:t.message}}},getIncomesBySource:async(r,e,s)=>{try{const t=await fetch(`${a}/api/v1/income/sources?userId=${r}&year=${e}&month=${s}`,{headers:o()});return{success:!0,data:await n(t)}}catch(t){return{success:!1,error:t.message}}},deleteIncome:async r=>{try{const e=await fetch(`${a}/api/v1/income/${r}`,{method:"DELETE",headers:o()});return await n(e),{success:!0}}catch(e){return{success:!1,error:e.message}}},updateIncome:async(r,e)=>{try{const s=await fetch(`${a}/api/v1/income/${r}`,{method:"PUT",headers:o(),body:JSON.stringify(e)});return{success:!0,data:await n(s)}}catch(s){return{success:!1,error:s.message}}},getMonthlySummary:async(r,e,s)=>{try{const t=await fetch(`${a}/api/v1/financial/summary?userId=${r}&year=${e}&month=${s}`,{headers:o()});return{success:!0,data:await n(t)}}catch(t){return{success:!1,error:t.message}}}};async function R(){try{const r=await fetch(`${a}/api/health/db`);let e=null,s=null;try{e=await r.json()}catch{try{s=await r.text()}catch{}}if(!r.ok){const t=e?.error||e?.message||s||r.statusText;throw g("DB Health Error: "+t,"error"),new Error(t)}return e}catch(r){throw g("Backend unreachable: "+r.message,"error"),r}}let l={backendReachable:!1,databaseConnected:!1,lastHealthCheck:null,consecutiveFailures:0,isRetrying:!1};const U={maxRetries:3,retryDelay:1e3,healthCheckTimeout:5e3,backoffMultiplier:2};async function A(){try{const r=new AbortController,e=setTimeout(()=>r.abort(),U.healthCheckTimeout),s=await fetch(`${a}/api/v1/auth/health`,{method:"GET",headers:{Accept:"application/json"},signal:r.signal});if(clearTimeout(e),s.ok){let t;try{const c=s.headers.get("content-type");if(c&&c.includes("application/json"))t=await s.json();else throw new Error("Backend returned non-JSON response")}catch{throw new Error("Backend returned invalid JSON response")}return l.backendReachable=!0,l.databaseConnected=t.database?.connected||!1,l.lastHealthCheck=new Date,l.consecutiveFailures=0,{success:!0,status:l.backendReachable&&l.databaseConnected?"healthy":"unhealthy",backend:{reachable:l.backendReachable,uptime:t.uptime||0},database:{connected:l.databaseConnected,url:t.database?.url||"",error:t.database?.error||null},timestamp:t.timestamp||new Date().toISOString()}}else{let t=`HTTP ${s.status}`;try{const c=s.headers.get("content-type");if(c&&c.includes("application/json"))t=(await s.json()).message||t;else{const i=await s.text();i.includes("<!DOCTYPE")||i.includes("<html>")?t="Backend service unavailable (returned HTML error page)":t=i.substring(0,100)||t}}catch{}throw new Error(`Health check failed: ${t}`)}}catch(r){l.backendReachable=!1,l.databaseConnected=!1,l.lastHealthCheck=new Date,l.consecutiveFailures++;let e="Backend unreachable",s="error";return r.name==="AbortError"?(e="Health check timeout - backend may be starting up",s="starting"):r.message.includes("fetch")||r.message.includes("NetworkError")||r.message.includes("Failed to fetch")?(e="Cannot connect to backend - service may be starting up",s="starting"):r.message.includes("HTML error page")||r.message.includes("invalid JSON")?(e="Backend service error - may be restarting",s="starting"):e=r.message,{success:!1,status:s,backend:{reachable:!1,uptime:0},database:{connected:!1,url:"",error:e},error:e,timestamp:new Date().toISOString()}}}function x(){return{...l}}const N={checkBackendHealth:A,checkDbHealth:R,getConnectionStatus:x,startHealthMonitoring:(r,e=3e4)=>setInterval(async()=>{const t=await A();r&&r(t)},e),stopHealthMonitoring:r=>{r&&clearInterval(r)}},M={clients:I,cessions:v,jobs:T,workplaces:E,auth:S,documents:b,payments:C,products:k,categories:D,stockMovements:O,financial:B,health:N},z=Object.freeze(Object.defineProperty({__proto__:null,api:M,authApi:S,categoriesApi:D,cessionsApi:v,checkBackendHealth:A,checkDbHealth:R,clientsApi:I,documentsApi:b,financialApi:B,getAuthHeaders:o,getConnectionStatus:x,healthApi:N,jobsApi:T,paymentsApi:C,productsApi:k,stockMovementsApi:O,workplacesApi:E},Symbol.toStringTag,{value:"Module"}));export{C as a,v as b,I as c,F as d,M as e,o as f,_ as g,B as h,D as i,T as j,S as k,z as l,k as p,O as s,E as w};
